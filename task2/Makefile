include config.mk

CC=avr-gcc
OBJCOPY=avr-objcopy
TARGET=main
SRCS=main.c

ifeq ($(findstring A, $(LED1)), A)
	DDR_LED1=DDRA
	PORT_LED1=PORTA
else
	DDR_LED1=DDRB
	PORT_LED1=PORTB
endif

ifeq ($(findstring A, $(LED2)), A)
	DDR_LED2=DDRA
	PORT_LED2=PORTA
else
	DDR_LED2=DDRB
	PORT_LED2=PORTB
endif

ifeq ($(findstring A, $(LED3)), A)
	DDR_LED3=DDRA
	PORT_LED3=PORTA
else
	DDR_LED3=DDRB
	PORT_LED3=PORTB
endif

ifeq ($(findstring B, $(BUTTON1)), B)
	DDR_BUTTON1=DDRB
	PORT_BUTTON1=PORTB
	PIN_BUTTON1=PINB
	PCMSK_BUTTON1=PCMSK1
else
	DDR_BUTTON1=DDRA
	PORT_BUTTON1=PORTA
	PIN_BUTTON1=PINA
	PCMSK_BUTTON1=PCMSK0
endif

ifeq ($(findstring B, $(BUTTON2)), B)
	DDR_BUTTON2=DDRB
	PORT_BUTTON2=PORTB
	PIN_BUTTON2=PINB
	PCMSK_BUTTON2=PCMSK1
else
	DDR_BUTTON2=DDRA
	PORT_BUTTON2=PORTA
	PIN_BUTTON2=PINA
	PCMSK_BUTTON2=PCMSK0
endif

ifeq ($(findstring B, $(KEY_SWITCH)), B)
	DDR_KEY_SWITCH=DDRB
	PORT_KEY_SWITCH=PORTB
	PIN_KEY_SWITCH=PINB
	PCMSK_KEY_SWITCH=PCMSK1
else
	DDR_KEY_SWITCH=DDRA
	PORT_KEY_SWITCH=PORTA
	PIN_KEY_SWITCH=PINA
	PCMSK_KEY_SWITCH=PCMSK0
endif


ifneq (,$(findstring ${MCU},attiny24 attiny44 attiny84))
		F_CPU=1200000
	else
		ifneq (,$(findstring ${MCU},attiny25 attiny45 attiny85))
			F_CPU=6000000
		else
			ifeq (${MCU}, attiny13)
				F_CPU=1200000
			endif
		endif
		PCMSK_BUTTON1=PCMSK
		PCMSK_BUTTON2=PCMSK
		PCMSK_KEY_SWITCH=PCMSK
	endif

GFLAGS =-std=c99 -Wall -g -Os -mmcu=${MCU} -DF_CPU=${F_CPU} -DLED1=P${LED1} -DLED2=P${LED2} -DLED3=P${LED3} \
	-DBUTTON1=P${BUTTON1} -DBUTTON2=P${BUTTON2} -DKEY_SWITCH=P${KEY_SWITCH}\
	-DPIN_BUTTON1=${PIN_BUTTON1} -DPIN_BUTTON2=${PIN_BUTTON2} -DPIN_KEY_SWITCH=${PIN_KEY_SWITCH}\
	-DPORT_LED1=${PORT_LED1} -DPORT_LED2=${PORT_LED2} -DPORT_LED3=${PORT_LED3}\
	-DPORT_BUTTON1=${PORT_BUTTON1} -DPORT_BUTTON2=${PORT_BUTTON2} -DPORT_KEY_SWITCH=${PORT_KEY_SWITCH}\
	-DDDR_LED1=${DDR_LED1} -DDDR_LED2=${DDR_LED2} -DDDR_LED3=${DDR_LED3}\
	-DDDR_BUTTON1=${DDR_BUTTON1} -DDDR_BUTTON2=${DDR_BUTTON2} -DDDR_KEY_SWITCH=${DDR_KEY_SWITCH}\
	-DPCMSK_BUTTON1=${PCMSK_BUTTON1} -DPCMSK_BUTTON2=${PCMSK_BUTTON2} -DPCMSK_KEY_SWITCH=${PCMSK_KEY_SWITCH}

all:
	${CC} ${GFLAGS} -o ${TARGET}.bin ${SRCS}
	${OBJCOPY} -j .text -j .data -O ihex ${TARGET}.bin ${TARGET}.hex